!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mobx")):"function"==typeof define&&define.amd?define(["mobx"],t):"object"==typeof exports?exports.pouch=t(require("mobx")):e.pouch=t(e.mobx)}(window,function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=13)}([function(e,t,r){"use strict";var n,o,i,u=r(9),s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function a(){i=!1}function c(e){if(e){if(e!==n){if(e.length!==s.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,r){return t!==r.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. These characters were not unique: "+t.join(", "));n=e,a()}}else n!==s&&(n=s,a())}function f(){return i||(i=function(){n||c(s);for(var e,t=n.split(""),r=[],o=u.nextValue();t.length>0;)o=u.nextValue(),e=Math.floor(o*t.length),r.push(t.splice(e,1)[0]);return r.join("")}())}e.exports={characters:function(e){return c(e),n},seed:function(e){u.seed(e),o!==e&&(a(),o=e)},lookup:function(e){return f()[e]},shuffled:f}},function(e,t,r){"use strict";var n=r(8);e.exports=function(e,t){for(var r,o=0,i="";!r;)i+=e(t>>4*o&15|n()),r=t<Math.pow(16,o+1),o++;return i}},function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lists=[],this.propertyName=t,this.Model=r,this.service=service,this.db=n,(0,o.extendObservable)(this,i({},t,[])),this.db.changes({since:"now",live:!0,include_docs:!0}).on("change",this.handleChanges)}return n(e,[{key:"query",value:function(e,t){var r,n=this,u=JSON.stringify(t);if(this.lists[e]&&this.lists[e].queries[u])return this.lists[e].queries[u];this.lists[e]||(this.lists[e]={mapFunc:e,queries:{}});var s={filterOptions:t,mapFunc:e};return(0,o.extendObservable)(s,(i(r={},this.propertyName,[]),i(r,"results",null),r)),t.local_query?(s.results=this.__localQuery(e,t),s[this.propertyName]=s.results.rows.map(function(e){return n.get(e.doc._id)||n.sideLoad(e.doc)})):this.service.db.query(e,t).then(function(e){s.results=e,s[n.propertyName]=s.results.rows.map(function(e){return n.get(e.doc._id)||n.sideLoad(e.doc)})}),this.lists[e].queries[u]=s,s}},{key:"removeQuery",value:function(e,t){var r=e;t||(r=e.mapFunc,t=e.filterOptions);var n=JSON.stringify(t);this.lists[r]&&this.lists[r].queries[n]&&(1===Object.keys(this.lists[r].queries).length?delete this.lists[r]:delete this.lists[r].queries[n])}},{key:"get",value:function(e){var t=this[this.propertyName].findIndex(function(t){return t._id===e});return t>-1?this[this.propertyName][t]:null}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.get(e);return n||this.db.get(e,r).then(function(e){var r=new t.Model(e);return t[t.propertyName].push(r),r})}},{key:"sideLoad",value:function(e){var t=new this.Model(e);return this[this.propertyName].push(t),t}},{key:"add",value:function(e){var t=this,r=e.toJS&&e.toJS()||e;return this.db.update(r).then(function(e){if(!e.ok)throw new Error(e);return r._rev=e.rev,t.sideLoad(r)})}},{key:"loadAll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{include_docs:!0,decending:!0};return this.db.getAll(t).then(function(t){return e[e.propertyName]=t.rows.map(function(t){return new e.Model(t)}),t.rows.forEach(function(t){return e.__queryDocOnChange(t)}),e[e.propertyName]})}},{key:"handleChanges",value:function(){rev.deleted?this.onDelete(rev.doc,rev):rev.changes&&this.onChange(rev.doc,rev)}},{key:"onChange",value:function(e,t){var r=this[this.propertyName].filter(function(t){return t._id===e._id})[0];r&&Object.keys(e).forEach(function(t){r[t]=e[t]}),this.__queryDocOnChange(e)}},{key:"onDelete",value:function(e){var t=this[this.propertyName].findIndex(function(t){return t._id===e._id});t>-1&&this[this.propertyName].splice(t,1),this.__queryDocOnChange(e,!0)}},{key:"__queryDocOnDelete",value:function(e){var t=this;Object.keys(this.lists).forEach(function(r){var n=t.lists[r];Object.keys(n.queries).forEach(function(r){var o=n.queries[r],i=o[t.propertyName].findIndex(function(t){return t._id===e._id});i>-1&&o[t.propertyName].splice(i,1)})})}},{key:"__queryDocOnChange",value:function(e){var t=this;Object.keys(this.lists).forEach(function(r){if(!r.startsWith("function"))throw new Error("Updating stored queries not yet supported");var n=t.lists[r];Object.keys(n.queries).forEach(function(r){var o=n.queries[r],i=o[t.propertyName].findIndex(function(t){return t._id===e._id});t.__queryDocument(e,n.mapFunc,o.filterOptions)?-1===i&&o[t.propertyName].push(t.get(e._id)||t.sideLoad(e)):i>-1&&o[t.propertyName].splice(i,1)})})}},{key:"__queryDocument",value:function(e,t,r){var n=[],o=r.key;return t(e,function(e){return n.push(e)}),!!n.length&&n.includes(o)}},{key:"__localQuery",value:function(e,t){var r=this,n=this[this.propertyName].filter(function(n){return r.__queryDocument(n,e,t)});return{total_rows:this[this.propertyName].length,offset:0,rows:n.map(function(e){return{id:e._id,key:t.key,doc:e}})}}}]),e}();t.default=u,(0,o.decorate)(u,{add:o.action,load:o.action,loadAll:o.action,sideLoad:o.action,onChange:o.action,onDelete:o.action,__queryDocOnChange:o.action,__queryDocOnDelete:o.action})},function(e,t,r){"use strict";e.exports=0},function(e,t,r){"use strict";var n=r(0);e.exports=function(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=n.characters(),r=e.length,o=0;o<r;o++)if(-1===t.indexOf(e[o]))return!1;return!0}},function(e,t,r){"use strict";var n,o,i=r(1),u=r(0),s=1459707606518,a=6;e.exports=function(e){var t="",r=Math.floor(.001*(Date.now()-s));return r===o?n++:(n=0,o=r),t+=i(u.lookup,a),t+=i(u.lookup,e),n>0&&(t+=i(u.lookup,n)),t+=i(u.lookup,r)}},function(e,t,r){"use strict";var n=r(0);e.exports=function(e){var t=n.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}},function(e,t,r){"use strict";var n="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=function(){if(!n||!n.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return n.getRandomValues(e),48&e[0]}},function(e,t,r){"use strict";var n=1;e.exports={nextValue:function(){return(n=(9301*n+49297)%233280)/233280},seed:function(e){n=e}}},function(e,t,r){"use strict";var n=r(0),o=(r(1),r(7)),i=r(6),u=r(5),s=r(4)||0;function a(){return i(s)}e.exports=a,e.exports.generate=a,e.exports.seed=function(t){return n.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&n.characters(e),n.shuffled()},e.exports.decode=o,e.exports.isValid=u},function(e,t,r){"use strict";e.exports=r(10)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),u=r(11),s=(n=u)&&n.__esModule?n:{default:n};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__edit=new Map,this.generateId()}return o(e,[{key:"generateId",value:function(){this._id=(0,s.default)()}},{key:"save",value:function(){var e=this,t=0;return this.edit.toJS().forEach(function(r,n){e[n]=r,++t}),this.clearE(),!!t}},{key:"toJS",value:function(){this.__edit;var e=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(this,["__edit"]);return Object.keys(e).forEach(function(t){e[t]&&e[t].toJS&&(e[t]=e[t].toJS(),Array.isArray(e[t])&&(e[t]=e[t].map(function(e){return e&&e.toJS?e.toJS():e})))}),e}},{key:"clearE",value:function(){this.__edit=new Map}},{key:"setE",value:function(e,t){this.__edit.set(e,t)}},{key:"getE",value:function(e){return void 0!==this.__edit.get(e)?this.__edit.get(e):this[e]}}]),e}();t.default=a,(0,i.decorate)(a,{_id:i.observable,__edit:i.observable,clearE:i.action,setE:i.action,save:i.action,generateId:i.action})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(12)),o=i(r(3));function i(e){return e&&e.__esModule?e:{default:e}}t.default={Model:n.default,ModelStore:o.default}}])});