!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mobx")):"function"==typeof define&&define.amd?define(["mobx"],t):"object"==typeof exports?exports.pouch=t(require("mobx")):e.pouch=t(e.mobx)}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t,n){"use strict";var r,o,i,u=n(9),s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function a(){i=!1}function c(e){if(e){if(e!==r){if(e.length!==s.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,a()}}else r!==s&&(r=s,a())}function f(){return i||(i=function(){r||c(s);for(var e,t=r.split(""),n=[],o=u.nextValue();t.length>0;)o=u.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}e.exports={characters:function(e){return c(e),r},seed:function(e){u.seed(e),o!==e&&(a(),o=e)},lookup:function(e){return f()[e]},shuffled:f}},function(e,t,n){"use strict";var r=n(8);e.exports=function(e,t){for(var n,o=0,i="";!n;)i+=e(t>>4*o&15|r()),n=t<Math.pow(16,o+1),o++;return i}},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lists=[],this.propertyName=t,this.Model=n,this.db=r,(0,o.extendObservable)(this,i({},t,[])),this.db.changes({since:"now",live:!0,include_docs:!0}).on("change",this.handleChanges.bind(this))}return r(e,[{key:"query",value:function(e,t){var n,r=this,u=JSON.stringify(t),s={filterOptions:t,mapFunc:e};if((0,o.extendObservable)(s,(i(n={},this.propertyName,[]),i(n,"results",null),n)),t.live){if(this.lists[e]&&this.lists[e].queries[u])return this.lists[e].queries[u];this.lists[e]||(this.lists[e]={mapFunc:e,queries:{}}),this.lists[e].queries[u]=s}return t.local_query?(s.results=this.__localQuery(e,t),s[this.propertyName]=s.results.rows.map(function(e){return r.get(e.doc._id)||r.sideLoad(e.doc)})):this.service.db.query(e,t).then(function(e){s.results=e,s[r.propertyName]=s.results.rows.map(function(e){return r.get(e.doc._id)||r.sideLoad(e.doc)})}),s}},{key:"removeQuery",value:function(e,t){var n=e;t||(n=e.mapFunc,t=e.filterOptions);var r=JSON.stringify(t);this.lists[n]&&this.lists[n].queries[r]&&(1===Object.keys(this.lists[n].queries).length?delete this.lists[n]:delete this.lists[n].queries[r])}},{key:"get",value:function(e){var t=this[this.propertyName].findIndex(function(t){return t._id===e});return t>-1?this[this.propertyName][t]:null}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.get(e);return r||this.db.get(e,n).then(function(e){var n=new t.Model(e);return t[t.propertyName].push(n),n})}},{key:"sideLoad",value:function(e){var t=new this.Model(e);return this[this.propertyName].push(t),t}},{key:"add",value:function(e){var t=this,n=e.toJS&&e.toJS()||e;return this.db.put(n).then(function(e){if(!e.ok)throw new Error(e);return n._rev=e.rev,t.sideLoad(n)})}},{key:"loadAll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{include_docs:!0,decending:!0};return this.db.allDocs(t).then(function(t){return e[e.propertyName]=t.rows.map(function(t){return new e.Model(t.doc)}),t.rows.forEach(function(t){return e.__queryDocOnChange(t)}),e[e.propertyName]})}},{key:"handleChanges",value:function(e){e.deleted?this.onDelete(e.doc,e):e.changes&&this.onChange(e.doc,e)}},{key:"onChange",value:function(e,t){var n=this[this.propertyName].filter(function(t){return t._id===e._id})[0];n&&Object.keys(e).forEach(function(t){n[t]=e[t]}),this.__queryDocOnChange(e)}},{key:"onDelete",value:function(e){var t=this[this.propertyName].findIndex(function(t){return t._id===e._id});t>-1&&this[this.propertyName].splice(t,1),this.__queryDocOnChange(e,!0)}},{key:"__queryDocOnDelete",value:function(e){var t=this;Object.keys(this.lists).forEach(function(n){var r=t.lists[n];Object.keys(r.queries).forEach(function(n){var o=r.queries[n],i=o[t.propertyName].findIndex(function(t){return t._id===e._id});i>-1&&o[t.propertyName].splice(i,1)})})}},{key:"__queryDocOnChange",value:function(e){var t=this;Object.keys(this.lists).forEach(function(n){if(!n.startsWith("function"))throw new Error("Updating stored queries not yet supported");var r=t.lists[n];Object.keys(r.queries).forEach(function(n){var o=r.queries[n],i=o[t.propertyName].findIndex(function(t){return t._id===e._id});t.__queryDocument(e,r.mapFunc,o.filterOptions)?-1===i&&o[t.propertyName].push(t.get(e._id)||t.sideLoad(e)):i>-1&&o[t.propertyName].splice(i,1)})})}},{key:"__queryDocument",value:function(e,t,n){var r=[],o=n.key;return t(e,function(e){return r.push(e)}),!!r.length&&r.includes(o)}},{key:"__localQuery",value:function(e,t){var n=this,r=this[this.propertyName].filter(function(r){return n.__queryDocument(r,e,t)});return{total_rows:this[this.propertyName].length,offset:0,rows:r.map(function(e){return{id:e._id,key:t.key,doc:e}})}}}]),e}();t.default=u,(0,o.decorate)(u,{add:o.action,load:o.action,loadAll:o.action,sideLoad:o.action,onChange:o.action,onDelete:o.action,__queryDocOnChange:o.action,__queryDocOnDelete:o.action})},function(e,t,n){"use strict";e.exports=0},function(e,t,n){"use strict";var r=n(0);e.exports=function(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=r.characters(),n=e.length,o=0;o<n;o++)if(-1===t.indexOf(e[o]))return!1;return!0}},function(e,t,n){"use strict";var r,o,i=n(1),u=n(0),s=1459707606518,a=6;e.exports=function(e){var t="",n=Math.floor(.001*(Date.now()-s));return n===o?r++:(r=0,o=n),t+=i(u.lookup,a),t+=i(u.lookup,e),r>0&&(t+=i(u.lookup,r)),t+=i(u.lookup,n)}},function(e,t,n){"use strict";var r=n(0);e.exports=function(e){var t=r.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}},function(e,t,n){"use strict";var r="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=function(){if(!r||!r.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return r.getRandomValues(e),48&e[0]}},function(e,t,n){"use strict";var r=1;e.exports={nextValue:function(){return(r=(9301*r+49297)%233280)/233280},seed:function(e){r=e}}},function(e,t,n){"use strict";var r=n(0),o=(n(1),n(7)),i=n(6),u=n(5),s=n(4)||0;function a(){return i(s)}e.exports=a,e.exports.generate=a,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.decode=o,e.exports.isValid=u},function(e,t,n){"use strict";e.exports=n(10)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),u=n(11),s=(r=u)&&r.__esModule?r:{default:r};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__edit=new Map,this.generateId()}return o(e,[{key:"generateId",value:function(){this._id=(0,s.default)()}},{key:"save",value:function(){var e=this,t=0;return this.__edit.toJS().forEach(function(n,r){e[r]=n,++t}),this.clearE(),!!t}},{key:"toJS",value:function(){this.__edit;var e=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(this,["__edit"]);return Object.keys(e).forEach(function(t){e[t]&&e[t].toJS&&(e[t]=e[t].toJS(),Array.isArray(e[t])&&(e[t]=e[t].map(function(e){return e&&e.toJS?e.toJS():e})))}),e}},{key:"clearE",value:function(){this.__edit=new Map}},{key:"setE",value:function(e,t){this.__edit.set(e,t)}},{key:"getE",value:function(e){return void 0!==this.__edit.get(e)?this.__edit.get(e):this[e]}}]),e}();t.default=a,(0,i.decorate)(a,{_id:i.observable,__edit:i.observable,clearE:i.action,setE:i.action,save:i.action,generateId:i.action})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12);Object.defineProperty(t,"Model",{enumerable:!0,get:function(){return i(r).default}});var o=n(3);function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"ModelStore",{enumerable:!0,get:function(){return i(o).default}}),t.default={}}])});
//# sourceMappingURL=mobx-pouchdb.js.map